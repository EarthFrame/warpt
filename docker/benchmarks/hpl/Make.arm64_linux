#
#  -- High Performance Computing --
#  HPL - 2.3 - December 2, 2018
#
#  HPL Configuration for Ubuntu ARM64 (OpenBLAS + OpenMPI)
#

# ----------------------------------------------------------------------
# - Shell and Standard Utility Definitions -----------------------------
# ----------------------------------------------------------------------

SHELL        = /bin/sh
CD           = cd
CP           = cp
LN_S         = ln -s
MKDIR        = mkdir
RM           = /bin/rm -f
TOUCH        = touch

# ----------------------------------------------------------------------
# - Platform Identifier ------------------------------------------------
# ----------------------------------------------------------------------

ARCH         = arm64_linux

# ----------------------------------------------------------------------
# - HPL Directory Structure / HPL Includes -----------------------------
# ----------------------------------------------------------------------

TOPdir       = /build/hpl-2.3
INCdir       = $(TOPdir)/include
BINdir       = $(TOPdir)/bin/$(ARCH)
LIBdir       = $(TOPdir)/lib/$(ARCH)

HPLlib       = $(LIBdir)/libhpl.a

# ----------------------------------------------------------------------
# - MPI Libraries, Paths, and Includes ---------------------------------
# ----------------------------------------------------------------------

# Using OpenMPI from apt packages
MPinc        = -I/usr/lib/aarch64-linux-gnu/openmpi/include
MPlib        = /usr/lib/aarch64-linux-gnu/libmpi.so

# ----------------------------------------------------------------------
# - Linear Algebra Libraries (BLAS or VSIPL) ---------------------------
# ----------------------------------------------------------------------

# Using OpenBLAS from apt packages
LAinc        = -I/usr/include/aarch64-linux-gnu
LAlib        = /usr/lib/aarch64-linux-gnu/libopenblas.so

# ----------------------------------------------------------------------
# - HPL Overrides ------------------------------------------------------
# ----------------------------------------------------------------------

# ----------------------------------------------------------------------
# - Compilation Control Options ----------------------------------------
# ----------------------------------------------------------------------

HPL_OPTS     = -DHPL_DETAILED_TIMING -DHPL_PROGRESS_REPORT

# ----------------------------------------------------------------------
# - Helpers ------------------------------------------------------------
# ----------------------------------------------------------------------

HPL_DEFS     = $(F2CDEFS) $(HPL_OPTS) $(HPL_INCLUDES)

# ----------------------------------------------------------------------
# - Compilers / linkers - Optimization Flags ---------------------------
# ----------------------------------------------------------------------

CC           = mpicc
CCNOOPT      = $(HPL_DEFS)
CCFLAGS      = $(HPL_DEFS) -fomit-frame-pointer -O3 -funroll-loops -W -Wall

LINKER       = mpicc
LINKFLAGS    = $(CCFLAGS)
ARCHIVER     = ar
ARFLAGS      = r
RANLIB       = echo

# ----------------------------------------------------------------------

HPL_INCLUDES = -I$(INCdir) -I$(INCdir)/$(ARCH) $(LAinc) $(MPinc)
HPL_LIBS     = $(HPLlib) $(LAlib) $(MPlib)

# ----------------------------------------------------------------------
# - End of HPL Configuration -------------------------------------------
# ----------------------------------------------------------------------
